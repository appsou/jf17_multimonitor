package.path = package.path .. ';'
	.. './Scripts/?.lua;'
	.. './LuaSerializer/?.lua;'

function env_dofile(env, f)
    local c, err = loadfile(f)
    if not c then
        log.error(err)
        return nil, err
    end
    setfenv(c, env)
    local res, err = pcall(c)
    if not res then
        log.error(err)
        return nil, err
    end
    return true
end

local config_dir = lfs.writedir() .. "Config/"
if not lfs.attributes(config_dir, 'mode') then
    lfs.mkdir(config_dir)
end

ConfigHelper = require('ConfigHelper')

if not options then options = {} end

-- set up graphic options
local _graphics = {}
env_dofile(_graphics, 'Config/graphics.lua')
if not options.graphics then options.graphics = {} end
setmetatable(options.graphics, { __index = _graphics })

local autoexec_cfg = config_dir .. 'autoexec.cfg'
if lfs.attributes(autoexec_cfg, 'mode') then
    dofile(autoexec_cfg)
end

guiDebugDraw = false
show_debug_output_console	= false

function onShadingSelection(deferred_shading)
	local to_remove = nil
	--CRUTCH REMOVE THOSE TEXTURE PACKS AS SOON AS POSSIBLE
	if deferred_shading then
		to_remove = "./Bazar/Textures/HUD_FILTER_NO_DS"
	else
		to_remove = "./Bazar/Textures/HUD_FILTER_DS"
	end
	for i,o in ipairs(options.graphics.VFSTexturePaths) do 
		if  o == to_remove then
			table.remove(options.graphics.VFSTexturePaths,i)
			break
		end
	end
end
